\documentclass[12pt, demo]{article}
\usepackage[margin=1in]{geometry}
\usepackage{siunitx}
\usepackage[version=4]{mhchem}
\usepackage{xltabular}
\usepackage{ragged2e}
\usepackage[font=small, skip=3pt]{caption}
\usepackage{float}
\usepackage{amsmath}
\usepackage{multirow}

\DeclareSIUnit{\mpl}{\mol\per\litre}
\DeclareSIUnit{\mmol}{\milli\mol}
\DeclareSIUnit{\gpm}{\gram\per\mol}
\DeclareSIUnit{\ml}{\milli\litre}

\sisetup{
	space-before-unit = true,
	free-standing-units = true,
	use-xspace = true
}

% TODO: figure out what "brand" of water deionizer the school uses

\begin{document}

\section*{Purpose}
Investigating the relationship between boiling tap water and the amount of chlorine concentration remaining.

\section*{Introduction}
Chlorine is a common disinfectant used by water treatment facilities to kill pathogens and viruses in water. <?# TODO: talk a bit more about how ?> However, while the concentration of chlorine present in our tap water isn't enough to make it harmful, it does create an unpleasant odour in the water.





% TODO: write about interest in water filters

\section*{Hypothesis}

\section*{Variables}

\section*{Apparatus}

\section*{Risk assessment}

% Calculate amount of "chlorine gas" released lol



\section*{Materials}

<?#
I ended up using 2 mL total of 1 mol/L K2CrO4
This produces 0.01M

I remember using 0.01M of AgNO3 as well
?>

\begin{itemize}
	\item Burette
	\item 0.1\mpl Silver Nitrate Solution
	\item 0.25\mpl Potassium Chromate Indicator Solution
	\item 250\ml Erlenmeyer Flask
	\item Hot Plate
\end{itemize}

\section*{Procedure}

\begin{enumerate}
	\item A silver nitrate solution (\ce{AgNO3(aq)}) was created by measuring out 0.0817\g of solid \ce{AgNO3} and diluting it with 50\ml of deionized water.
	\item A dilute solution of 0.01\mpl \ce{K2CrO4} was created by measuring out 2\ml of the 0.1\mpl stock solution and diluting it with 10\ml of deionized water.
	\item The \ce{AgNO3} solution was poured into a burette.
	\item 10\ml of tap water was transported into a 100\ml Erlenmeyer flask using a 10\ml pipette.
	\item Approximately 1\ml of the 0.01\mpl \ce{K2CrO4} solution was added to the 10\ml of tap water using a dropper.
	\item The initial volume of \ce{AgNO3} solution in the burette was noted down. The tap water was titrated with the \ce{AgNO3} solution until the solution turned reddish-brown (see Figure x). The final amount of solution in the burette was noted down.
	\item Steps 4 to 6 were repeated for 2-3 more trials.
	\item Steps 4 to 7 were repeated for deionized water and water boiled for 3, 6, 9, and 20 minutes using a hot plate.
\end{enumerate}

\section*{Data}

% \begin{noindent}
<?
const silverNitrateSol = {
	mass: 0.0817,
	volume: 0.05,
	concentration: undefined,
};

/*
[0]: # of minutes boiled (or 'deionized' if the water was deionized)
[1]: mL of AgNO3 needed
[2]: mL of H2O used
*/

const rawData = [
	['deionized', 11.75 - 11.45, 10],
	['deionized', 31.15 - 30.8, 10],
	['deionized', 31.6 - 31.15, 10],
	[0, 11.45 - 10.15, 10],
	[0, 17.45 - 16.2, 10],
	[0, 18.7 - 17.45, 10],
	[3, 5.6 - 4.3, 10],
	[3, 14.3 - 13, 10],
	[3, 13 - 11.75, 10],
	[6, 20.15 - 18.7, 10],
	[6, 30.8 - 29.4, 10],
	[6, 7 - 5.6, 10],
	[9, 16.2 - 14.3, 10],
	[9, 10.15 - 8.65, 10],
	[20, 26.4 - 20.15, 10],
	[20, 29.4 - 26.4, 5],
];

const headers = ['minutesBoiled', 'titrantAmount', 'amountOfWater'];

const data = rawData.map(row => Object.fromEntries(R.zip(headers, row)));
?>
% \end{noindent}

\begin{table}[H]
	\caption{TODO}
	\def\arraystretch{1.5}
	\begin{tabularx}{\linewidth}{|
			>{\RaggedRight}X|
			>{\RaggedRight}X|
			>{\RaggedRight}X|
			>{\RaggedRight}X|
		}
		\hline
		\textbf{Trial Number}                &
		\textbf{Time Boiled} /\si{\minute}   &
		\textbf{Titrant Amount} /$\pm$0.1\ml &
		\textbf{Amount of Water} /$\pm$0.05\ml
		\\\hline
		% \begin{noindent}
		<? for (const [rowIndex, row] of data.entries()) { ?>
			Trial <?= rowIndex + 1 ?>
			& <?= row.minutesBoiled ?>
			& <?= row.titrantAmount.toFixed(2) ?>
			& <?= row.amountOfWater ?>
			\\\hline
		<? } ?>
		% \end{noindent}
	\end{tabularx}
\end{table}

\section*{Calculations}

To determine the amount of chloride ions in the water, the amount of water and the amount of titrant is used.

The mass of \ce{AgNO3_{(s)}} used to create the silver nitrate solution was <?= silverNitrateSol.mass ?>\g. The analytical scale used to weigh this amount had an uncertainty of $\pm$0.0001\g. Using this information, the number of moles of silver nitrate in the solution can be determined:
%
\begin{align*}
	n_{\ce{AgNO3}} & = \frac{m_{\ce{AgNO3}}}{M_{\ce{AgNO3}}}
	\\
	n_{\ce{AgNO3}} & = \frac{(<?= silverNitrateSol.mass ?> \pm 0.0001)\g}{169.87\gpm}
	\\
	<? silverNitrateSol.moles = silverNitrateSol.mass / 169.87 -?>
	n_{\ce{AgNO3}} & = <?= sf(silverNitrateSol.moles, 3) ?>\mol \pm <?= sf(0.0001 / silverNitrateSol.mass * 100, 1) ?>\%
\end{align*}

The silver nitrate was diluted with 50\ml of deionized water using a graduated cylinder with an uncertainty of 0.5\ml or 1\%. Using the number of moles of \ce{AgNO3} in the solution, the concentration of the solution can be determined:
%
\begin{align*}
	c & = \frac{n}{V}
	\\
	c & = \frac{<?= sf(silverNitrateSol.moles, 3) ?>\mol \pm 0.1\%}{<?= silverNitrateSol.volume ?>\litre \pm 1\%}
	\\
	<? silverNitrateSol.concentration = silverNitrateSol.moles / silverNitrateSol.volume -?>
	c & = <?= sf(silverNitrateSol.concentration, 3) ?>\mpl \pm 1.1\%
\end{align*}

The concentration of the \ce{AgNO3} solution can then be used to determine the moles of \ce{AgNO3} for a given volume of the silver nitrate solution. For example, using the data in Trial 1, the volume of the silver nitrate solution needed to titrate the water was 1.30\ml $\pm$ 0.1\ml, or 1.30\ml $\pm$ 7.7\%, giving the following number of moles of \ce{AgNO3}:
%
\begin{align*}
	n & = V \times c
	\\
	n & = (1.30\ml \pm 7.7\%) \times (<?= sf(silverNitrateSol.concentration, 3) ?>\mpl \pm 1.1\%)
	\\
	<? const trial1Calculations = { molesOfSilverNitrate: silverNitrateSol.concentration * 1.30 } -?>
	n & = <?= sf(trial1Calculations.molesOfSilverNitrate, 3) ?>\mmol \pm 8.8\%
\end{align*}

The number of moles of \ce{AgNO3} can then be used to determine the number of moles of chloride ions in the water. The mole ratio between \ce{Ag^-} and \ce{Cl^-} can be determined from the reaction taking place between the silver nitrate and the chloride ions:

\centerline{\ce{AgNO3_{(aq)} + Cl^{-}_{(aq)} -> AgCl_{(s)} + NO3^{-}_{(aq)}}}

From the above balanced chemical equation, it can be determined that the mole ratio between \ce{Ag^-} and \ce{Cl^-} is 1. Therefore, the number of moles of \ce{AgNO3} is equal to the number of moles of \ce{Cl^-}:
%
\begin{align*}
	n_{\ce{Cl^-}} & = n_{\ce{AgNO3}}
	\\
	<? trial1Calculations.molesOfChlorine = trial1Calculations.molesOfSilverNitrate -?>
	n_{\ce{Cl^-}} & = <?= sf(trial1Calculations.molesOfChlorine, 3) ?>\mmol \pm 8.8\%
\end{align*}

From here, the concentration of chloride ions in the water can be determined knowing that the amount of water used was 10\ml $\pm$ 0.05\ml, or 10\ml $\pm$ 0.5\%:
%
\begin{align*}
	c & = \frac{<?= sf(trial1Calculations.molesOfChlorine, 3) ?>\mmol \pm 8.8\%}{10\mL \pm 0.5\%}
	\\
	c & = <?= sf(trial1Calculations.molesOfChlorine / 10, 3) ?>\mpl \pm 9\%
\end{align*}

The above calculations were performed for each of the values in the 16 trials, producing the following values:

% \begin{noindent}
<?
function calculateMolesOfChlorine(rowIndex: number) {
	const row = data[rowIndex];
	return row.titrantAmount * silverNitrateSol.concentration / row.amountOfWater;
}

function calculateMolesOfChlorineUncertaintyPercentage(rowIndex: number) {
	const row = data[rowIndex];
	const silverNitrateUncertaintyPercentage = 1.1;
	const titrantUncertaintyPercentage = (0.1 / row.titrantAmount) * 100;
	const amountOfWaterUncertaintyPercentage = 0.5;
	const totalUncertaintyPercentage =
		silverNitrateUncertaintyPercentage +
		titrantUncertaintyPercentage +
		amountOfWaterUncertaintyPercentage;
	return totalUncertaintyPercentage;
}

function formatFinalMolesOfChlorine(rowIndex: number) {
	const moles = calculateMolesOfChlorine(rowIndex);
	const uncertaintyPercentage = calculateMolesOfChlorineUncertaintyPercentage(rowIndex);
	return roundToUncertaintyDecimalPlaces(moles, uncertaintyPercentage);
}

function roundToUncertaintyDecimalPlaces(value: number, uncertaintyPercentage: number) {
	const uncertaintyString = sf(value * (uncertaintyPercentage / 100), 1);
	const decimalPlaces = uncertaintyString.length - uncertaintyString.indexOf('.') - 1;
	return `${value.toFixed(decimalPlaces)} $\\pm$ ${uncertaintyString}`;
}
?>
% \end{noindent}

\begin{table}[H]
	\caption{TODO}
	\def\arraystretch{1.5}
	\begin{tabularx}{\linewidth}{|X|X|X|}
		\hline
		\textbf{Time Boiled} /\si{\minute}
		 & \textbf{Amount of \ce{Cl^-}} /\si{\mmol}
		 & \textbf{Average amount of \ce{Cl^-}} /\si{\mmol}
		\\\hline
		% \begin{noindent}
		<? for (const [rowIndex, row] of data.entries()) { ?>
			<?= row.minutesBoiled ?>
			& <?= formatFinalMolesOfChlorine(rowIndex) ?>
			&
			<? if (row.minutesBoiled !== data[rowIndex - 1]?.minutesBoiled) { ?>
				<?
					const end = data.findIndex((dataRow, i) => i >= rowIndex && dataRow.minutesBoiled !== row.minutesBoiled);
					const trialIndexes = R.range(rowIndex, end === -1 ? data.length : end);
					const trialMoles = trialIndexes.map(
						(trialIndex) => calculateMolesOfChlorine(trialIndex)
					);
					const averageMolesOfChlorine = R.mean(trialMoles);
					const sumOfUncertaintyOfAverage = R.sum(trialIndexes.map(
						(trialIndex) =>
							calculateMolesOfChlorine(trialIndex) *
							(calculateMolesOfChlorineUncertaintyPercentage(trialIndex) / 100)
					));
					const uncertaintyPercentageOfAverage = sumOfUncertaintyOfAverage / R.sum(trialMoles) * 100
				?>
				\multirow{
					<?=
						R.count(
							(r) => r.minutesBoiled === row.minutesBoiled,
							data
						)
					?>
				}{*}{<?= roundToUncertaintyDecimalPlaces(averageMolesOfChlorine, uncertaintyPercentageOfAverage) ?>}
				\\\cline{1-2}
			<? } else if (row.minutesBoiled !== data[rowIndex + 1]?.minutesBoiled) { ?>
				\\\hline
			<? } else { ?>
				\\\cline{1-2}
			<? } ?>
		<? } ?>
		% \end{noindent}
	\end{tabularx}
\end{table}

Plotting these values on a graph yields the following result:

\begin{figure}[H]
	\centering
	\caption{TODO}
	\includegraphics{assets/}
\end{figure}


\section*{Analysis}

% TODO: cite https://www.toronto.ca/311/knowledgebase/kb/docs/articles/toronto-water/water-treatment-and-supply/water-treatment-plants/f.j.-horgan-treatment-plant/reasons-that-the-city-uses-chlorine-to-treat-drinking-water.html
To verify the accuracy of this amount, the number of moles of chlorine can be compared to the recommended amount of chlorine concentration in drinking water: between 1\mg/\litre and 3\mg/\litre:
%
\begin{align*}
	m_{\ce{Cl^-}} & = n_{\ce{Cl^-}} \times M_{\ce{Cl^-}}
	\\
	M_{\ce{Cl^-}} & = 35.45\gpm
	\\
	m_{\ce{Cl^-}} & = <?= sf(trial1Calculations.molesOfChlorine, 3) ?>\mmol \times 35.45\gpm
	\\
	<? trial1Calculations.massOfChlorine = trial1Calculations.molesOfSilverNitrate * 35.45 -?>
	m_{\ce{Cl^-}} & = <?= sf(trial1Calculations.massOfChlorine, 3) ?>\mg
\end{align*}

Converting this amount to \si{\mg\per\litre} gives us the following amount:
%
\begin{align*}
	c = <?= sf(trial1Calculations.massOfChlorine, 3) ?>\mg/10\ml
	\\
	c = <?= sf(trial1Calculations.massOfChlorine * 100, 3) ?>\mg/\litre
\end{align*}

This result is off by an order of magnitude. A possible explanation for this is that the \ce{AgNO3} solution and \ce{K2CrO4} solutions were too dilute, so the initial colour change when all the \ce{AgNO3} ions had been formed was too faint to notice.

<?#
Looks like Toronto uses chloramine to disinfect water???
https://www.aquatell.ca/blogs/aquatell/chloramine-use-in-canadian-cities
?>

<?#
https://aquanswers.com/does-boiling-water-remove-chlorine-chloramine/
?>

\end{document}